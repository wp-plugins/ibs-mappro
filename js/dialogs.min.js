(function(a){Map.prototype.setLineAttr=function(b){return a("<span>").addClass("view-hide").append(a("<div>").addClass("section-header").html("Line Attributes")).append(a("<div>").addClass("line-attr").append(a("<span>").addClass("line-attr-span").html("Opacity")).append(a("<input>").attr({type:"text",value:".5",max:"1.0",min:"0.1",step:"0.1"}).addClass("opacity-val")).append(a("<span>").addClass("line-attr-span").html("Width")).append(a("<input>").attr({type:"text",value:"2",max:"15",min:"1",step:"1"}).addClass("width-val")).append(a("<select>").addClass(b)))};
Map.prototype.setFileExtension=function(){return a("<span>").addClass("view-hide").append(a("<span>").append(a("<div>").addClass("section-header").html("File type")).append(a("<div>").addClass("kmlkmzgpx").append(a("<span>").html("*.kml").append(a("<input>").addClass("file-kml").attr({type:"radio",value:"kml",name:"file_ext"}))).append(a("<span>").html("*.kmz").append(a("<input>").addClass("file-kmz").attr({type:"radio",value:"kmz",name:"file_ext"}))).append(a("<span>").html("*.gpx").append(a("<input>").addClass("file-gpx").attr({type:"radio",
value:"gpx",name:"file_ext"}))))).append(a("<span>").addClass("file-ext-span").append(a("<div>").addClass("section-header").text("GPX content settings")).append(a("<div>").addClass("box-div").append(a("<span>").text("Tracks").append(a("<input>").addClass("gpx_tracks").attr({type:"checkbox",title:"output tracks "}))).append(a("<span>").text("Routes").append(a("<input>").addClass("gpx_routes").attr({type:"checkbox",title:"output routes "}))).append(a("<span>").text("Waypoints").append(a("<input>").addClass("gpx_waypoints").attr({type:"checkbox",
title:"output waypoints"}))).append(a("<span>").text("Placemarks").append(a("<input>").addClass("gpx_waypoints").attr({type:"checkbox",title:"output placemarks"})))))};Map.prototype.setDialogs=function(){this.html.dialogs=this.html["ibs-container"].append(a("<div>"));this.html.dialogs.append(a("<div>").addClass("placemark-dialog hide dialog-map").attr({title:"Placemark"}).append(a("<div>").addClass("info-div edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("placemark-dialog-name view-disable").attr({type:"text",
size:32,value:""})))).append(a("<span>").append(a("<span>").addClass("kmlkmzgpx").append(a('<div class="placemark-selected-div">').append(a("<img>").addClass("placemark-selected-icon").attr({src:"",height:"32",width:"32",title:"current icon"}).css("vertical-align","middle")).append(a('<span style="font-weight:bold; margin-left:10px">').text("Current Icon"))).append(a("<div>").addClass("placemark-select-div view-hide ").append(a("<ul>").addClass("placemark-dialog-select")))))).append(a("<div>").addClass("edit-ck-div").append(a("<textarea>").addClass("placemark-dialog-desc view-hide").attr({rows:5,
cols:32}))).append(a("<input>").addClass("placemark-dialog-pid").attr({type:"hidden",value:""})));this.html["placemark-dialog"]=this.html.dialogs.find(".placemark-dialog");this.html.dialogs.append(a("<div>").addClass("waypoint-dialog hide").attr({title:"Waypoint"}).append(a("<div>").addClass("box-div").append(a("<input>").addClass("waypoint-dialog-name view-disable").attr({type:"text",size:"32",value:""}))).append(a("<div>").addClass("edit-ck-div").append(a("<textarea>").addClass("waypoint-dialog-desc view-hide").css({"margin-top":"25px"}).attr({rows:"5",
cols:"32"}))).append(a("<input>").addClass("placemark-dialog-pid").attr({type:"hidden",value:""})));this.html["waypoint-dialog"]=this.html.dialogs.find(".waypoint-dialog");this.html.dialogs.append(a("<div>").addClass("placemark-show hide dialog-map").attr("title","Segment").append(a("<div>").addClass("info-div edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("placemark-dialog-name").attr({type:"text",
value:""}))))).append(a("<div>").addClass("edit-ck-div").append(a("<div>").addClass("placemark-dialog-desc"))).append(a("<input>").addClass("placemark-dialog-pid").attr({type:"hidden",value:"0"})));this.html["placemark-show"]=this.html.dialogs.find(".placemark-show");this.html.dialogs.append(a("<div>").addClass("segment-dialog hide dialog-map").attr("title","Segment").append(a("<div>").addClass("info-div edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("segment-dialog-name view-disable").attr({type:"text",
value:""})))).append(this.setLineAttr("segment-dialog-color-select")).append(a("<span>").append(a("<div>").addClass("section-header").html("Statistics")).append(a("<span>").addClass("segment-dialog-stats")))).append(a("<div>").addClass("edit-ck-div").append(a("<textarea>").addClass("segment-dialog-desc view-hide").attr({rows:"2",cols:"50"}))).append(a("<input>").addClass("segment-dialog-sid").attr({type:"hidden",value:"0"})));this.html["segment-dialog"]=this.html.dialogs.find(".segment-dialog");this.html.dialogs.append(a("<div>").addClass("segment-show hide dialog-map").attr("title",
"Segment").append(a("<div>").addClass("info-div edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("segment-dialog-name view-disable").attr({type:"text",value:""})))).append(a("<span>").append(a("<div>").addClass("section-header").html("Statistics")).append(a("<span>").addClass("segment-dialog-stats")))).append(a("<div>").addClass("edit-ck-div").append(a("<div>").addClass("segment-dialog-desc view-hide"))).append(a("<input>").addClass("segment-dialog-sid").attr({type:"hidden",
value:"0"})));this.html["segment-show"]=this.html.dialogs.find(".segment-show");this.html.dialogs.append(a("<div>").addClass("find-dialog hide dialog-map").attr({title:"Find Address"}).append(a("<div>").addClass("ibs-find-box file-list-box").append(a("<input>").addClass("find-words").attr({type:"text",name:"words",size:"50",value:""}))).append(a("<div>").addClass("find-div file-list-div").append(a("<ul>").addClass("find-list file-list"))));this.html["find-dialog"]=this.html.dialogs.find(".find-dialog");
this.html.dialogs.append(a("<div>").addClass("save-dialog hide dialog-map").attr({title:"Save File"}).addClass("").append(a("<div>").addClass("file-save-box").addClass("edit-hdr-div").append(a("<span>").addClass("mapfolder-span").append(a("<div>").addClass("section-header").html(" Map Folders ")).append(a("<div>").addClass("mapfolder-div")).append(a("<div>").addClass("mapfolder-browser JQueryFTD"))).append(a("<span>").append(a("<div>").addClass("section-header").html("Save As")).append(a("<div>").addClass("kmlkmzgpx").append(a("<span>").html("Folder").append(a("<input>").addClass("save-dir").attr({type:"text",
size:"20",value:""}))).append(a("<span>").html("Name").append(a("<input>").addClass("save-name").attr({type:"text",size:"20",value:""}))).append(a("<span>").html("Download").addClass("hide").append(a("<input>").addClass("save-download").attr({type:"checkbox"}))))).append(this.setFileExtension())).append(a("<div>").addClass("edit-ck-div").css("width","100%").append(a("<textarea>").addClass("save-desc").attr({rows:"10",cols:"50"}))));this.html["save-dialog"]=this.html.dialogs.find(".save-dialog");this.html.dialogs.append(a("<div>").addClass("file-dialog hide dialog-map").attr({title:"Map settings"}).append(a("<div>").addClass("info-div file-box edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("File Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("file-name view-disable").css("margin",
"5px").attr({type:"text",size:"30",value:""}))).append(this.setFileExtension())).append(a("<span>").append(a("<div>").addClass("section-header").html("Statistics")).append(a("<ul>").addClass("file-list ct-help-list"))).append(this.setLineAttr("file-dialog-color-select"))).append(a("<div>").addClass("edit-ck-div").css("width","100%").append(a("<textarea>").addClass("file-desc view-hide").attr({rows:"3",cols:"50"}))));this.html["file-dialog"]=this.html.dialogs.find(".file-dialog");this.html["file-dialog"].find(".line-attr").append(a("<div>").css("float",
"right").append(a("<button>").addClass("reset-lines").attr({title:"reset all lines to these attributes"}).text("Reset lines").css({"margin-left":"15px"})));this.html.dialogs.append(a("<div>").addClass("file-show hide dialog-map").attr({title:"Map settings"}).append(a("<div>").addClass("info-div file-box edit-hdr-div").append(a("<span>").append(a("<div>").addClass("section-header").html("File Name")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("file-name").css("margin","5px").attr({type:"text",
size:"30",value:""})))).append(a("<span>").append(a("<div>").addClass("section-header").html("Statistics")).append(a("<ul>").addClass("file-list ct-help-list")))).append(a("<div>").addClass("edit-ck-div").css("width","100%").append(a("<div>").addClass("file-desc view-hide").attr({rows:"3",cols:"50"}))));this.html["file-show"]=this.html.dialogs.find(".file-show");this.html.dialogs.append(a("<div>").addClass("cuesheet-dialog hide dialog-map").attr({title:"Cuesheet"}).append(a("<textarea>").addClass("cuesheet").attr({rows:"50",
cols:"70"})));this.html["cuesheet-dialog"]=this.html.dialogs.find(".cuesheet-dialog");this.html.dialogs.append(a("<div>").addClass("browse-dialog hide dialog-map").attr("title","Browse maps").append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").html("Map Folders")).append(a("<div>").addClass("map-browser-div").append(a("<div>").addClass("map-browser JQueryFTD"))))));this.html["browse-dialog"]=this.html.dialogs.find(".browse-dialog");this.html.dialogs.append(a("<div>").addClass("upload-dialog hide dialog-map").attr("title",
"Upload maps").append(a("<div>").addClass("upload-browser admin")).append(a("<div>").addClass("admin").append(a("<span>").append(a("<div>").addClass("section-header").html("Target")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").attr({type:"text",size:"75",value:"/"}).addClass("upload-target-directory"))))).append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").css({"font-size":".9em","padding-left":"5px"}).html("status")).append(a("<div>").addClass("map-upload-div file-list-div").css("height",
"100px").append(a("<ul>").addClass("upload-list file-list")))).append(a("<div>").css("display","none").append(a("<div>").addClass("upload-button").html("Browse")))));this.html["upload-dialog"]=this.html.dialogs.find(".upload-dialog");this.html.dialogs.append(a("<div>").addClass("web-dialog hide dialog-map").attr("title","Open map").append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").html("Map URL to load")).append(a("<div>").addClass("kmlkmzgpx").append(a("<input>").addClass("map-web-url").attr({type:"text",
title:"enter url to load from the web",size:"50"}))))));this.html["web-dialog"]=this.html.dialogs.find(".web-dialog");this.html.map.append(a("<div>").addClass("segment-cm-line context-menu hide").append(a("<ul>").addClass("cm-list").append(a("<li>").append(a("<a>").addClass("cm-line-action").attr({href:"#",rel:"split",title:"split line here"}).html("Split"))).append(a("<li>").addClass("img_placemark").append(a("<a>").addClass("cm-line-action").attr({href:"#",rel:"waypoint",title:"add waypoint"}).html("Waypoint"))).append(a("<li>").addClass("img_line-edit").append(a("<a>").addClass("cm-line-action").attr({href:"#",
rel:"line-edit",title:"segment line editing"}).html("Line-edit"))).append(a("<li>").append(a("<a>").addClass("cm-line-action").attr({href:"#",rel:"close"}).html("Close")))));this.html["segment-cm-line"]=this.html.map.find(".segment-cm-line");this.html.map.append(a("<div>").addClass("segment-cm-edit context-menu hide").append(a("<ul>").addClass("cm-list").append(a("<li>").append(a("<a>").addClass("cm-edit-action").attr({href:"#",rel:"clear"}).html("Clear"))).append(a("<li>").append(a("<a>").addClass("cm-edit-action").attr({href:"#",
rel:"delete"}).html("Delete point"))).append(a("<li>").append(a("<a>").addClass("cm-edit-action").attr({href:"#",rel:"split"}).html("Split"))).append(a("<li>").append(a("<hr/>"))).append(a("<li>").append(a("<a>").addClass("cm-edit-action").attr({href:"#",rel:"close"}).html("Close")))));this.html["segment-cm-edit"]=this.html.map.find(".segment-cm-edit");this.html.map.append(a('<div style="width:200px;">').addClass("placemark-cm-info context-menu hide").append(a("<div>").addClass("placemark-cm-name")).append(a("<div>").addClass("placemark-cm-desc")));
this.html["placemark-cm-info"]=this.html.map.find(".placemark-cm-info");this.html.map.append(a("<div>").addClass("distance-info hide"));this.html["distance-info"]=this.html.map.find(".distance-info")};Map.prototype.findDialog=function(){var b=this.html["find-dialog"];b.dialog({autoOpen:!0,modal:!1,width:"auto",buttons:{Find:a.proxy(function(){this.findLocation()},this),Close:function(){a(this).dialog("close")}},close:a.proxy(function(){b.dialog("destroy")},this)})};Map.prototype.browseDialog=function(){var b=
this.html["browse-dialog"];b.dialog({autoOpen:!0,width:600,modal:!0,buttons:{Select:a.proxy(function(){var c="";b.find("a.selected").each(function(){d=a(this).attr("rel");c+=a(this).text()+";"});if(""!==c){var d=d.replace(ibs_mappro.maps_path,ibs_mappro.maps_url),e=purl(d),d=e.data.attr.base+e.data.attr.directory,c=d+c.slice(0,c.length-1);this.file.importFile(c)}b.dialog("close")},this),Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:a.proxy(function(){var c=
this.isGuest()?ibs_mappro.maps_path+"share/":ibs_mappro.maps_path;b.find(".map-browser").fileTree({root:c,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=map",folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},a.proxy(function(a){},this),function(a){})},this)})};Map.prototype.uploadDialog=function(){var b=this.html["upload-dialog"];b.dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{"Select Files":a.proxy(function(){var a=this.html["upload-dialog"].find(".upload-button");a.find("input[qq-button-id]");
a.find("input").trigger("click")},this),Clear:function(){b.find(".upload-list").empty()},Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:a.proxy(function(){var c=ibs_mappro.maps_path+"upload/";b.find(".upload-target-directory").val("upload/");this.uploader.fineUploader("setParams",{dir:c});this.isAdmin()?(b.find(".admin").removeClass("hide"),b.find(".upload-browser").fileTree({root:ibs_mappro.maps_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=dir",
folderEvent:"click",expandSpeed:1E3,collapseSpeed:1E3,multiFolder:!1},function(a){alert(a)},a.proxy(function(a){b.find(".upload-target-directory").val(a);b.find(".upload-target-directory").trigger("change")},this))):(b.find(".admin").addClass("hide"),c=b.find(".upload-button"),c.find("input[qq-button-id]"),c.find("input").trigger("click"))},this)})};Map.prototype.webDialog=function(){var b=this.html["web-dialog"];b.dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{Open:a.proxy(function(){var a=this.html["web-dialog"].find(".map-web-url").val();
a&&isUrl(a)?(b.dialog("close"),this.file.importFile(a)):this.alert("invalid URL.")},this),Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:a.proxy(function(){},this)})};File.prototype.getOptions=function(a){switch(getExtension(this.filename)){case "kmz":a.find(".file-kmz").attr("checked",!0);break;case "gpx":a.find(".file-gpx").attr("checked",!0);break;default:a.find(".file-kml").attr("checked",!0)}a.find(".gpx_routes").attr("checked",this.options.gpx_routes);
a.find(".gpx_tracks").attr("checked",this.options.gpx_tracks);a.find(".gpx_waypoints").attr("checked",this.options.gpx_waypoints);a.find(".gpx_placemarks").attr("checked",this.options.gpx_placemarks)};File.prototype.setOptions=function(a){this.options.gpx_routes=a.find(".gpx_routes").is(":checked");this.options.gpx_tracks=a.find(".gpx_tracks").is(":checked");this.options.gpx_waypoints=a.find(".gpx_waypoints").is(":checked");this.options.gpx_placemarks=a.find(".gpx_placemarks").is(":checked")};File.prototype.saveDialog=
function(){var b=this.options.map,c=b.html["save-dialog"],d=b.getCkeditorConfig();this.getOptions(c);c.find(".save-name").val(this.filename);c.find(".save-dir").val(b.getUserFolder());c.find(".save-desc").val(this.desc);c.dialog({autoOpen:!0,modal:!0,width:"auto",buttons:{Save:a.proxy(function(){this.checkMapname(c.find(".save-name").val())?(this.options.desc=c.find(".save-desc").val(),this.dir=c.find(".save-dir").val(),this.dir=b.isGuest()?"share/"+this.dir:this.dir,this.filename=c.find(".save-name").val(),
getExtension(this.filename),b.html.list.find("a.file-list-name").text(this.filename),this.setOptions(c),c.dialog("close"),this.saveAs(!1)):alert('invalid filename.\n Only "A-Z a-z 0-9 _ - space" characters are allowed\n 3 - 50 characters long.')},this),Cancel:function(){a(this).dialog("close")}},open:function(){c.find(".mapfolder-browser").fileTree({root:ibs_mappro.maps_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=dir",folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},
function(a){alert(a)},function(a){a=a.split("/maps/");c.find(".save-dir").val(a[1]);c.find(".save-dir").trigger("change")});c.find(".save-desc").ckeditor(d);c.find(".save-desc").ckeditor().resize("100%","100%",!1)},close:function(){c.find(".save-desc").ckeditorGet().destroy();a(this).dialog("destroy")},resize:function(a){c.find(".save-desc").ckeditor().resize("100%","100%",!1)}})};File.prototype.fileDialog=function(){var b=this.options.map.html["file-dialog"];this.getOptions(b);this.options.map.stats(b.find(".file-list"),
this.distance(),Object.keys(this.segments).length,Object.keys(this.placemarks).length);b.find(".file-name").val(this.filename);b.find(".file-desc").val(this.desc);b.find(".colorpicker-trigger").css("background-color",this.options.strokeColor);b.find(".colorpicker-trigger").css("opacity",parseFloat(this.options.strokeOpacity).toFixed(1));b.find(".colorpicker-trigger").css("height",this.options.strokeWeight+"px");var c=parseInt((30-this.options.strokeWeight)/2);b.find(".colorpicker-trigger").css("margin-top",
c+"px");b.find(".opacity-val").val(parseFloat(this.options.strokeOpacity).toFixed(1));b.find(".width-val").val(parseInt(this.options.strokeWeight));var d=this.options.map.getCkeditorConfig();setCurrentColor(b);b.dialog({autoOpen:!0,modal:!0,width:"auto",buttons:{Update:a.proxy(function(){if(this.checkMapname(b.find(".file-name").val())){var c=b.find(".colorpicker-trigger"),d=rgb2hex(a(c).css("background-color")),f=parseFloat(a(c).css("opacity")).toFixed(3),c=parseInt(a(c).css("height").replace(/px/,
""));this.setOptions(b);this.options.strokeColor=d;this.options.strokeOpacity=f;this.options.strokeWeight=c;this.setDirty(this.dirty||b.find(".file-name").val()!==this.filename||b.find(".file-desc").val()!==this.desc);this.filename=b.find(".file-name").val();this.desc=b.find(".file-desc").val();this.options.map.html.list.find(".list-filename").text(this.filename);b.dialog("close")}else alert("invalid kml, kmz, gpx filename.")},this),Close:function(){a(this).dialog("close")}},open:function(){b.find(".file-desc").ckeditor(d);
b.find(".file-desc").ckeditor().resize("100%","100%",!1)},close:function(){b.find(".file-desc").ckeditorGet().destroy();a(this).dialog("destroy")},resize:function(a){b.find(".file-desc").ckeditor().resize("100%","100%",!1)}})};File.prototype.show=function(){var b=this.options.map.html["file-show"];this.getOptions(b);this.options.map.stats(b.find(".file-list"),this.distance(),Object.keys(this.segments).length,Object.keys(this.placemarks).length);b.find(".file-name").val(this.filename).attr({disabled:!0});
b.find(".file-desc").html(this.desc);b.dialog({autoOpen:!0,modal:!0,width:"auto",buttons:{Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")}})};Segment.prototype.segmentDialog=function(){var b=this.options.map.html["segment-dialog"],c=this.options.map.getCkeditorConfig(),d=b.find(".segment-dialog-color-select option"),e=this.options.strokeColor.toLowerCase();a.each(d,function(b,c){c.value.toLowerCase()===e?a(c).attr("selected",!0):a(c).removeAttr("selected")});
b.find(".segment-dialog-fid").val(this.options.fid);b.find(".segment-dialog-sid").val(this.options.sid);b.find(".segment-dialog-desc").val(this.options.desc);b.find(".segment-dialog-name").val(this.options.name);b.find(".colorpicker-trigger").css("background-color",this.options.strokeColor);b.find(".colorpicker-trigger").css("opacity",parseFloat(this.options.strokeOpacity).toFixed(1));b.find(".colorpicker-trigger").css("height",this.options.strokeWeight+"px");d=parseInt((30-this.options.strokeWeight)/
2);b.find(".colorpicker-trigger").css("margin-top",d+"px");b.find(".opacity-val").val(parseFloat(this.options.strokeOpacity).toFixed(1));b.find(".width-val").val(this.options.strokeWeight);b.find(".segment-dialog-stats").html(" miles="+this.options.map.convertMeters2(this.distance()).toString()+" points: "+this.line.getPath().getLength());setCurrentColor(b);b.dialog({autoOpen:!0,width:600,modal:!0,buttons:{Update:a.proxy(function(){var c=b.find(".colorpicker-trigger");this.options.strokeColor=rgb2hex(a(c).css("background-color"));
this.options.strokeOpacity=parseFloat(a(c).css("opacity")).toFixed(3);this.options.strokeWeight=parseInt(a(c).css("height").replace(/px/,""));this.options.name=b.find(".segment-dialog-name").val();this.options.desc=b.find(".segment-dialog-desc").val();this.line.setOptions({strokeColor:this.options.strokeColor,strokeOpacity:this.options.strokeOpacity,strokeWeight:this.options.strokeWeight});this.options.file.setDirty(!0);a(this.segmentList).find(this.segmentItem).html(this.options.name);b.dialog("close")},
this),Close:function(){a(this).dialog("close")}},open:function(){b.find(".segment-dialog-desc").ckeditor(c);b.find(".segment-dialog-desc").ckeditor().resize("100%","100%",!1)},close:function(){b.find(".segment-dialog-desc").ckeditorGet().destroy();a(this).dialog("destroy")},resize:function(a){b.find(".segment-dialog-desc").ckeditor().resize("100%","100%",!1)}})};Segment.prototype.cuesheetDialog=function(){var b=this.options.map.html["cuesheet-dialog"],c=this.options.map.getCkeditorConfig();b.find(".cuesheet").data({segment:this});
this.options.map.html["cuesheet-dialog"].dialog({autoOpen:!0,resizable:!0,draggable:!0,width:600,modal:!1,buttons:{Update:a.proxy(function(){this.cueUpdatePath()},this),Close:a.proxy(function(){b.dialog("close")},this)},open:function(){this.isActive=!1;b.find(".cuesheet").ckeditor(c)},close:a.proxy(function(){this.isActive=!0;b.find(".cuesheet").ckeditorGet().destroy();b.dialog("destroy");this.directionsRenderer&&this.directionsRenderer.getMap()&&this.directionsRenderer.setMap(null);this.cuesheetKill()},
this)})};Segment.prototype.show=function(){var b=this.options.map.html["segment-show"];b.find(".segment-dialog-sid").val(this.options.sid);b.find(".segment-dialog-desc").html(this.options.desc);b.find(".segment-dialog-name").val(this.options.name).attr({disabled:!0});b.find(".segment-dialog-stats").html(" miles="+this.options.map.convertMeters2(this.distance()).toString()+" points: "+this.line.getPath().getLength());b.dialog({autoOpen:!0,width:600,modal:!0,buttons:{Close:function(){a(this).dialog("close")}},
close:function(){a(this).dialog("destroy")}})};Placemark.prototype.show=function(){var b=this.options.map.html["placemark-show"];b.find(".placemark-dialog-pid").val(this.options.pid);b.find(".placemark-dialog-desc").html(this.options.desc);b.find(".placemark-dialog-name").val(this.options.name).attr({disabled:!0});b.dialog({autoOpen:!0,width:600,modal:!0,buttons:{Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")}})};Placemark.prototype.placemarkDialog=function(){var b=
this.options.map.html["placemark-dialog"],c=this.options.map.getCkeditorConfig();this.options.map.infowindow.close();"Waypoint"===this.options.symbol?(b=this.options.map.html["waypoint-dialog"],b.find(".waypoint-dialog-name").val(this.options.name),b.find(".waypoint-dialog-fid").val(this.options.fid),b.find(".waypoint-dialog-pid").val(this.options.pid),b.find(".waypoint-dialog-desc").val(this.options.desc),b.dialog({autoOpen:!0,height:"auto",width:600,modal:!0,zIndex:100,buttons:{Update:a.proxy(function(){this.setName(b.find(".waypoint-dialog-name").val());
a(this.placemarkList).find(this.placemarkItem).text(b.find(".waypoint-dialog-name").val());this.options.desc=b.find(".waypoint-dialog-desc").val();this.marker.setVisible(!0);b.dialog("close");this.options.file.setDirty(!0)},this),Close:function(){a(this).dialog("close")}},close:function(){b.find(".waypoint-dialog-desc").ckeditorGet().destroy();a(this).dialog("destroy")},open:function(){b.find(".waypoint-dialog-desc").ckeditor(c);b.find(".waypoint-dialog-desc").ckeditor().resize("100%","100%",!1)},
resize:function(a){b.find(".waypoint-dialog-desc").ckeditor().resize("100%","100%",!1)}})):(b=this.options.map.html["placemark-dialog"],b.find(".placemark-selected-icon").attr("src",this.options.url),b.find(".placemark-dialog-name").val(this.options.name),b.find(".placemark-dialog-fid").val(this.options.fid),b.find(".placemark-dialog-pid").val(this.options.pid),b.find(".placemark-dialog-desc").val(this.options.desc),b.dialog({autoOpen:!0,height:"auto",width:600,modal:!0,buttons:{Update:a.proxy(function(){this.setName(b.find(".placemark-dialog-name").val());
this.options.url=b.find(".placemark-selected-icon").attr("src");this.setIcon();a(this.placemarkList).find(this.placemarkItem).text(b.find(".placemark-dialog-name").val());a(this.placemarkList).find(this.placemarkItem).parent().find("img").attr("src",this.options.url);this.options.desc=b.find(".placemark-dialog-desc").val();this.marker.setVisible(!0);b.dialog("close");this.options.file.setDirty(!0)},this),Close:function(){a(this).dialog("close")}},close:function(){b.find(".placemark-dialog-desc").ckeditorGet().destroy();
a(this).dialog("destroy")},open:function(){b.find(".placemark-dialog-desc").ckeditor(c);b.find(".placemark-dialog-desc").ckeditor().resize("100%","100%",!1)},resize:function(a){b.find(".placemark-dialog-desc").ckeditor().resize("100%","100%",!1)}}))}})(jQuery);
