jQuery(document).ready(function(a){function g(){a(".current-icon-name").each(function(c,b){var d="ibs_mappro_icons[index][name]".replace(/index/,c);a(b).attr("name",d)});a(".current-icon-url").each(function(c,b){var d="ibs_mappro_icons[index][url]".replace(/index/,c);a(b).attr("name",d)})}a("#icon-library-select").on("change","",{map:this},function(c){c=a("#icon-library-select").val();a(".map-icon").each(function(b,d){a(d).data("qtip")&&(a(d).qtip("destroy",!0),a(d).removeData("hasqtip"),a(d).removeAttr("data-hasqtip"))});
a.get(ibs_mappro.ajax,{action:"ibs_mappro_icons",lib:c},function(b,d){a("#icon-library-list").empty();for(var c in b)a("#icon-library-list").append('<img class="map-icon" src="'+b[c]+'" title="'+getFilename(b[c])+'" width="32" height="32" />');a(".map-icon").qtip();a(".map-icon").draggable({revert:!0,activeClass:"ui-state-highlight"})},"json")});a("#current-icon-list").sortable({stop:function(a,b){g()}});a("#garmin-library-select").on("change","",{map:this},function(c){c=a("#garmin-library-select").val();
a.get(ibs_mappro.ajax,{action:"ibs_mappro_icons",lib:c},function(b,d){a("#garmin-library-list").empty();for(var c in b)a("#garmin-library-list").append('<img class="map-icon" src="'+b[c]+'" title="'+getFilename(b[c])+'" width="32" height="32" />');a(".map-icon").draggable({revert:!0,activeClass:"ui-state-highlight"})},"json")});a(".garmin-icon-name").droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(c,b){var d=b.draggable.attr("src"),e=a(this).parents("li")[0];
a(e).find(".garmin-icon-url").val(d);d="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,b.draggable.attr("src"));a(e).attr("style",d)}});a(".current-icon-name").droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(c,b){var d=b.draggable.attr("src");a(this).val(getFilename(d));var e=a(this).parents("li")[0];a(e).find(".current-icon-url").val(d);d="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,b.draggable.attr("src"));
a(e).attr("style",d)}});a("#icon-add-input").droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(c,b){var d=b.draggable.attr("src"),e=getFilename(d),e=a("<input>").addClass("current-icon-name").attr({type:"text",value:e,name:"ibs_mappro_icons[0][name]"}),f="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,d);a("#current-icon-list").prepend(a("<li>").addClass("current-icon-item").attr({style:f}).append(a("<div>").append(e).append(a("<a>").addClass("icon-delete").text(" ").attr({href:"#",
title:"delete"}))).append(a("<input>").addClass("current-icon-url").attr({type:"hidden",value:d,name:"ibs_mappro_icons[0][url]"})));g();a(e).droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(b,c){var d=c.draggable.attr("src");a(this).val(getFilename(d));var e="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,c.draggable.attr("src")),f=a(this).parents("li")[0];a(f).find(".current-icon-url").val(d);a(f).attr("style",e)}})}});a("#current-icon-list").on("click",
".icon-delete",{},function(c){a(this).parents("li").eq(0).remove();g()});a("#ibs-icon-upload").append(a('<div id="upload-dialog" >').addClass("hide dialog-map").attr("title","Upload Icons").append(a('<div id="upload-browser" >')).append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").html("Target")).append(a("<div>").addClass("kmlkmzgpx").append(a('<input id="upload-target-directory" >').attr({type:"text",size:"75",value:"/"}))))).append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").css({"font-size":".9em",
"padding-left":"5px"}).html("status")).append(a("<div >").addClass("map-upload-div file-list-div").css("height","100px").append(a('<ul id="upload-list" >').addClass(" file-list")))).append(a("<div>").css("display","none").append(a('<div id="upload-button" >').html("Browse")))));var h=a("#upload-button").fineUploader({listElement:a("#upload-list"),request:{endpoint:ibs_mappro.site+"js/jquery.fineuploader/server/endpoint.php",params:{dir:ibs_mappro.maps_path+"upload/"}},debug:!1});h.on("complete","",
{},function(c,b,d,e){var f=a("#upload-target-directory").val().replace("/",""),k=!1;a(".icon-lib").each(function(b,c){a(c).val()===f&&(k=!0)});!1===k&&a("#icon-library-select").prepend(a("<option>").attr({value:f}).addClass("icon-lib").text(f).trigger("change"));a("#icon-library-select").val(f);a("#icon-library-select").trigger("change")});a("#upload-target-directory").on("change","",{},function(c){var b=ibs_mappro.icons_path;c=a("#upload-target-directory").val().replace(b,"");-1===c.indexOf(b)&&
(c=b+c);c===b&&(c=b+"new/");c=(c+"/").replace("//","/");b=c.replace(b,"");a("#upload-target-directory").val(b).focus();h.fineUploader("setParams",{dir:c})});a("#ibs-upload-action").on("click","",{},function(c){a("#upload-dialog").dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{"Select Files":a.proxy(function(){var b=a("#upload-button");b.find("input[qq-button-id]");b.find("input").trigger("click")},this),Clear:function(){a("#upload-list").empty()},Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},
open:function(){var b=ibs_mappro.icons_path+"new/";a("#upload-target-directory").val("new/");h.fineUploader("setParams",{dir:b});a("#upload-browser").fileTree({root:ibs_mappro.icons_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=dir",folderEvent:"click",expandSpeed:1E3,collapseSpeed:1E3,multiFolder:!1},function(a){alert(a)},function(b){a("#upload-target-directory").val(b);a("#upload-target-directory").trigger("change")})}})});a("#ibs-icon-clean").append(a('<div id="clean-dialog" >').addClass("hide dialog-map").attr("title",
"Manage Icon Folders").append(a('<div id="clean-browser" >')).append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").html("Target")).append(a("<div>").addClass("kmlkmzgpx").append(a('<input id="clean-target-directory" >').attr({type:"text",size:"75",value:"/",disabled:!0}))))));a("#ibs-clean-action").on("click","",{},function(c){a("#clean-target-directory").val("");a("#clean-dialog").dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{"Remove Files":function(){var b="";a("#clean-browser").find("LI A.selected").each(function(c){b+=
a(this).attr("rel")+";"});0<b.length&&a.get(ibs_mappro.ajax,{action:"ibs_mappro_remove",type:"files",dir:ibs_mappro.icons_path+a("#clean-target-directory").val(),files:b},function(b,c){a("#clean-browser").find("LI A.selected").remove()},"TEXT")},"Remove Folder":function(){a.get(ibs_mappro.ajax,{action:"ibs_mappro_remove",type:"directory",dir:ibs_mappro.icons_path+a("#clean-target-directory").val()},function(b,c){a("#clean-browser").find("LI.expanded").remove();var e=a("#clean-target-directory").val().replace("/",
"");a(".icon-lib").each(function(b,c){a(c).val()===e&&a(c).remove()})},"TEXT")},Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:function(){a("#clean-browser").fileTree({root:ibs_mappro.icons_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=all",folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},function(b){if(c.shiftKey){var d=!1,e=!1,f=a(this).attr("rel");a(this).parent().parent().find("A").each(function(b){e&&d?a(this).removeClass("selected"):
(a(this).attr("rel")===f?e=!0:a(this).hasClass("selected")&&!d&&(d=!0),(d||e)&&a(this).addClass("selected"))})}else c.ctrlKey?a(this).toggleClass("selected"):(b=a(this).hasClass("selected"),a(this).parent().parent().find("A").removeClass("selected"),!1===b&&a(this).addClass("selected"))},function(b){a("#clean-target-directory").val(b.replace(ibs_mappro.icons_path,""))})}})});a("#ibs-map-clean").append(a('<div id="map-dialog" >').addClass("hide dialog-map").attr("title","Manage Map Folders").append(a('<div id="map-browser" >')).append(a("<div>").append(a("<span>").append(a("<div>").addClass("section-header").html("Target")).append(a("<div>").addClass("kmlkmzgpx").append(a('<input id="map-target-directory" >').attr({type:"text",
size:"75",value:"/",disabled:!0}))))));a("#ibs-map-manage").on("click","",{},function(c){a("#map-target-directory").val("");a("#map-dialog").dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{"Remove Files":function(){var b="";a("#map-browser").find("LI A.selected").each(function(c){b+=a(this).attr("rel")+";"});0<b.length&&a.get(ibs_mappro.ajax,{action:"ibs_mappro_remove",type:"files",dir:ibs_mappro.maps_path+a("#map-target-directory").val(),files:b},function(b,c){a("#map-browser").find("LI A.selected").remove()},
"TEXT")},"Remove Folder":function(){a.get(ibs_mappro.ajax,{action:"ibs_mappro_remove",type:"directory",dir:ibs_mappro.maps_path+a("#map-target-directory").val()},function(b,c){a("#map-browser").find("LI.expanded").remove();a("#map-target-directory").val().replace("/","")},"TEXT")},Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:function(){a("#map-browser").fileTree({root:ibs_mappro.maps_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=all",folderEvent:"click",
expandSpeed:0,collapseSpeed:0,multiFolder:!1},function(b){if(c.shiftKey){var d=!1,e=!1,f=a(this).attr("rel");a(this).parent().parent().find("A").each(function(b){e&&d?a(this).removeClass("selected"):(a(this).attr("rel")===f?e=!0:a(this).hasClass("selected")&&!d&&(d=!0),(d||e)&&a(this).addClass("selected"))})}else c.ctrlKey?a(this).toggleClass("selected"):(b=a(this).hasClass("selected"),a(this).parent().parent().find("A").removeClass("selected"),!1===b&&a(this).addClass("selected"))},function(b){a("#map-target-directory").val(b.replace(ibs_mappro.maps_path,
""))})}})});a("#shortcode-browser").fileTree({root:ibs_mappro.maps_path,script:ibs_mappro.ajax+"?action=ibs_mappro_folders&type=map",folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},function(c){c=c.replace(ibs_mappro.maps_path,ibs_mappro.maps_url);c=purl(c);var b=c.data.attr.base+c.data.attr.directory;a("#shortcode-browser").find("a.selected").each(function(){b+=a(this).text()+";"});b=b.slice(0,b.length-1);a("#shortcode-url").val(b);a("#shortcode-url").trigger("change")},function(a){});
a("#shortcode-options").on("change",".shortcode-input",{},function(c){var b="[ibs-mappro ";a("#shortcode-options").find("select").each(function(c,e){""!==a(e).val()&&(b+=a(e).attr("name")+'="'+a(e).val()+'" ')});a("#shortcode-options").find("input").each(function(c,e){""!==a(e).val()&&(b+=a(e).attr("name")+'="'+a(e).val()+'" ')});a("#shortcode").val(b+"]")})});
