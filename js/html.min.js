(function(a){Map.prototype.setHtml=function(){a(this.options.div).append(a("<div>").attr("id",this.options.mid).append(a("<div>").addClass("ibs-container").resizable().append(a("<div>").addClass("ibs-header")).append(a("<div>").addClass("ibs-main")).append(a("<div>").addClass("ibs-footer"))));this.html.page=a("#"+this.options.mid);this.html["ibs-container"]=this.html.page.find(".ibs-container");this.html["ibs-header"]=this.html["ibs-container"].find(".ibs-header");"admin"!==this.options.user_type&&
a("#content").css("font-size","13px");"edit"===this.options.mode?this.html["ibs-header"].append(a("<div>").append(a("<button>").addClass("ibs-map").attr({title:"map action menu",href:"#","data-dropdown":"#"+this.options.mid+"-dropdown-map"})).append(a("<button>").addClass("ibs-route").attr({title:"route action menu",href:"#","data-dropdown":"#"+this.options.mid+"-dropdown-route"})).append(a("<button>").addClass("ibs-draw").attr({title:"drawing settings",href:"#","data-dropdown":"#"+this.options.mid+
"-dropdown-options"})).append(a("<button>").addClass("ibs-display").attr({title:"display settings",href:"#","data-dropdown":"#"+this.options.mid+"-dropdown-display"})).append(a("<button>").addClass("ibs-settings").attr({title:"edit settings",href:"#"})).append(a("<button>").addClass("ibs-find").attr({title:"find address",href:"#"})).append(a("<button>").addClass("ibs-reset").attr({title:"reset map",href:"#"})).append(a("<a>").addClass("ibs-size size-up").attr({title:"restore size and position",href:"#"}).text("X"))):
this.html["ibs-header"].append(a("<div>").append(a("<button>").addClass("ibs-map").attr({title:"map action menu",href:"#","data-dropdown":"#"+this.options.mid+"-dropdown-map"})).append(a("<button>").addClass("ibs-display").attr({title:"display settings",href:"#","data-dropdown":"#"+this.options.mid+"-dropdown-display"})).append(a("<a>").addClass("ibs-size size-up").attr({title:"restore size and position",href:"#"}).text("X")));this.html["ibs-main"]=this.html["ibs-container"].find(".ibs-main");this.html["ibs-footer"]=
this.html["ibs-container"].find(".ibs-footer");this.html["ibs-main"].append(a("<div>").addClass("list").css({display:"edit"===this.options.mode?"block":"none"}).resizable().append(a("<div>").addClass("file-list-name list-hdr img-kml").append('<a class="list-action-edit list-filename" href="#" title="edit file attributes"></a>')).append(a("<div>").addClass("import-list-name list-hdr img-upload").append('<a class="list-action-import" href="#" title="imported maps files">Imported maps</a>')).append(a("<div>").addClass("import-list-div hide").resizable({containment:"parent"}).append(a("<ul>").addClass("import-list"))).append(a("<div>").addClass("placemark-list-name list-hdr img-marker").append('<a class="list-action-placemark" href="#" title="add new placemarker">Marker</a>')).append(a("<div>").addClass("placemark-list-div").resizable({containment:"parent"}).append(a("<ul>").addClass("placemark-list controls"))).append(a("<div>").addClass("segment-list-name list-hdr img-line").append('<a class="list-action-route" href="#" title="start new route">Route</a>')).append(a("<div>").addClass("segment-list-div").resizable({containment:"parent"}).append(a("<ul>").addClass("segment-list controls")))).append(a("<div>").addClass("app").append(a("<div>").addClass("map").append(a("<div>").addClass("map-div"))).append(a("<div>").addClass("data")));
this.html.list=a(this.html["ibs-main"]).find(".list");this.html.app=a(this.html["ibs-main"]).find(".app");this.html.map=a(this.html.app).find(".map");this.html["map-div"]=a(this.html.map).find(".map-div");this.html.data=a(this.html.app).find(".data");a(this.html.data).append(a("<span>").addClass("box-span").append(a("<span>").addClass("data-segment")).append(a("<span>").addClass("data-distance")).append(a("<span>").addClass("data-gain")).append(a("<img>").addClass("chart-close").css("float","right").attr("src",
ibs_mappro.site+"image/minus.png"))).append(a("<div>").addClass("data-chart"));this.html["data-chart"]=a(this.html.data).find(".data-chart");this.html.map.append(a("<div>").addClass("distance-info hide")).append(a("<div>").addClass("pend-info hide"));this.html["ibs-footer"].append(a("<div>").addClass("ibs-message"));this.setDialogs();"edit"===this.options.mode?(a(document).find("body").append('<div id="'+this.options.mid+'-dropdown-map" class="dropdown dropdown-tip has-icons"><ul class="dropdown-menu dropdown-list"><li class="dropdown-divider"></li><li class="img-browse"><a class="map-action-browse user-hide"  href="#">Browse server</a></li><li class="img-save"><a class="map-action-save user-hide" href="#">Save to server</a></li><li class="dropdown-divider"></li><li class="img-upload"><a class="map-action-upload"  href="#">Desktop upload</a></li><li class="img-download"><a class="map-action-download" href="#">Desktop download</a></li><li class="dropdown-divider"></li><li class="img-web"><a class="map-action-web"  href="#">Web import</a></li><li class="dropdown-divider"></li><li class="img-document"><a class="map-action-show" href="#">Show xml</a></li><li class="dropdown-divider"></li><li class="img-focus"><a class="map-action-focus" href="#">Focus map</a></li><li class="dropdown-divider"></li><li class="img-edit"><a class="map-action-edit" href="#">Edit map info</a></li><li class="dropdown-divider"></li><li class="img-delete"><a class="map-action-clear"  href="#">Clear</a></li><li class="dropdown-divider"></li><li class="dropdown-divider"></li><li class="img-sort"><a class="map-action-sort"  href="#">Sort placemarkers</a></li><li class="img-flip"><a class="map-action-flip" href="#">Reverse travel direction</a></li><li class="dropdown-divider"></li></ul></div><div id="'+
this.options.mid+'-dropdown-route" class="dropdown dropdown-tip has-icons"><ul class="dropdown-menu dropdown-list"><li class="dropdown-divider"></li><li class="img-extend"><a class="route-action-extend" href="#">Extend route</a></li><li class="img-undo"><a class="route-action-undo" href="#">Undo</a></li><li class="img-refresh"><a class="route-action-rebuild" href="#">Rebuild</a></li><li class="img-focus"><a class="route-action-focus" href="#">Focus</a></li><li class="img-cue"><a class="route-action-cue" href="#">Google directions</a></li><li class="img-cue"><a class="route-action-profile" href="#">Elevation profile</a></li><li class="dropdown-divider"></li><li class="img-edit"><a class="route-action-edit" href="#">Edit</a></li><li class="dropdown-divider"></li><li class="img-delete"><a class="route-action-remove" href="#">Remove</a></li><li class="dropdown-divider"></li><li class="img-append"><a class="route-action-append" href="#">Append to next line</a></li><li class="img-line-edit"><a class="route-action-ledit" href="#">Line edit</a></li><li class="img-flip"><a class="route-action-flip" href="#">Reverse direction</a></li><li class="img-thin"><a class="route-action-thin" href="#">Minimize points</a></li><li class="dropdown-divider"></li></ul></div><div id="'+
this.options.mid+'-dropdown-display" class="dropdown dropdown-tip"><ul class="dropdown-menu"><li class="dropdown-divider"></li><li><label><input class="control-distance-flag" type="checkbox" /> Distance flag</label></li><li><label><input class="control-bike-layer" type="checkbox" /> Bike layer</label></li><li><label><input class="control-placemarks" type="checkbox" /> Show placemarks</label></li><li><label><input class="control-waypoints" type="checkbox" /> Show waypoints</label></li><li class="dropdown-divider"></li></ul></div><div id="'+
this.options.mid+'-dropdown-options" class="dropdown dropdown-tip"><ul class="dropdown-menu"><li class="dropdown-divider"></li><li><label><input class="control-followroad" type="checkbox"  /> Follow road</label></li><li><label><input class="control-avoidhighways" type="checkbox"  /> Avoid highways</label></li><li class="dropdown-divider"></li><li><label><input class="control-rb-drive" type="radio" name="travelmode" value="DRIVING" /> Driving</label></li><li><label><input class="control-rb-bike" type="radio" name="travelmode" value="BICYCLING"/> Bicycling </label></li><li><label><input class="control-rb-walk" type="radio" name="travelmode" value="WALKING"/> Walking</label></li><li class="dropdown-divider"></li></ul></div>'),
this.html["dd-route"]=a("#"+this.options.mid+"-dropdown-route"),this.html["dd-map"]=a("#"+this.options.mid+"-dropdown-map"),this.html["dd-options"]=a("#"+this.options.mid+"-dropdown-options"),this.html["dd-display"]=a("#"+this.options.mid+"-dropdown-display"),this.html["dd-options"].find(".control-followroad").prop("checked",this.options.followroad),this.html["dd-options"].find(".control-avoidhighways").prop("checked",this.options.avoidhighways),this.html["dd-options"].find(".control-rb-drive").prop("checked",
"DRIVING"===this.options.travelmode),this.html["dd-options"].find(".control-rb-bike").prop("checked","BICYCLING"===this.options.travelmode),this.html["dd-options"].find(".control-rb-walk").prop("checked","WALKING"===this.options.travelmode)):(""===this.options.url?a(document).find("body").append('<div id="'+this.options.mid+'-dropdown-map" class="dropdown dropdown-tip has-icons"><ul class="dropdown-menu dropdown-list"><li class="dropdown-divider"></li><li class="img-browse"><a class="map-action-browse"  href="#">Browse</a></li><li class="img-upload"><a class="map-action-upload"  href="#">Upload</a></li><li class="img-download"><a class="map-action-download" href="#">Download</a></li><li class="dropdown-divider"></li><li class="img-web"><a class="map-action-web"  href="#">Web import</a></li><li class="dropdown-divider"></li><li class="img-document"><a class="map-action-show" href="#">Show xml</a></li><li class="dropdown-divider"></li><li class="img-focus"><a class="map-action-focus" href="#">Focus map</a></li><li class="dropdown-divider"></li><li class="img-edit"><a class="map-action-edit" href="#">Statistics</a></li><li class="dropdown-divider"></li><li class="img-delete"><a class="map-action-clear"  href="#">Clear</a></li><li class="dropdown-divider"></li></ul></div><div id="'+
this.options.mid+'-dropdown-display" class="dropdown dropdown-tip"><ul class="dropdown-menu"><li class="dropdown-divider"></li><li><label><input class="control-distance-flag" type="checkbox" /> Distance flag</label></li><li><label><input class="control-bike-layer" type="checkbox" /> Bike layer</label></li><li><label><input class="control-placemarks" type="checkbox"/> Show placemarks</label></li><li><label><input class="control-waypoints" type="checkbox" /> Show waypoints</label></li><li class="dropdown-divider"></li></ul></div>'):
a(document).find("body").append('<div id="'+this.options.mid+'-dropdown-map" class="dropdown dropdown-tip has-icons"><ul class="dropdown-menu dropdown-list"><li class="dropdown-divider"></li><li class="img-download"><a class="map-action-download" href="#">Download</a></li><li class="dropdown-divider"></li><li class="img-document"><a class="map-action-show" href="#">Show xml</a></li><li class="dropdown-divider"></li><li class="img-focus"><a class="map-action-focus" href="#">Focus map</a></li><li class="dropdown-divider"></li><li class="img-edit"><a class="map-action-edit" href="#">Statistics</a></li><li class="dropdown-divider"></li></ul></div><div id="'+
this.options.mid+'-dropdown-display" class="dropdown dropdown-tip"><ul class="dropdown-menu"><li class="dropdown-divider"></li><li><label><input class="control-distance-flag" type="checkbox" /> Distance flag</label></li><li><label><input class="control-bike-layer" type="checkbox" /> Bike layer</label></li><li><label><input class="control-placemarks" type="checkbox" checked /> Show placemarks</label></li><li><label><input class="control-waypoints" type="checkbox" /> Show waypoints</label></li><li class="dropdown-divider"></li></ul></div>'),
this.html["dd-map"]=a("#"+this.options.mid+"-dropdown-map"),this.html["dd-display"]=a("#"+this.options.mid+"-dropdown-display"));this.getIconOptions(this.html["placemark-dialog"].find(".placemark-dialog-select"));this.html["file-dialog"].find(".file-dialog-color-select").colorpicker({size:20,label:"Color ",hide:!0});this.html["segment-dialog"].find(".segment-dialog-color-select").colorpicker({size:20,label:"Color ",hide:!0});this.html.dialogs.find(".cp-cancel").attr("src",ibs_mappro.site+"image/cancel.png");
this.html["cuesheet-dialog"].find("input[name=cue_source][value="+this.options.cuesheet_source+"]").attr("checked",!0);a(this.html["file-dialog"]).find(".reset-lines").button({text:!0,label:"Set Lines",icons:{primary:"ui-icon-arrowreturnthick-1-e"}});this.uploader=this.html["upload-dialog"].find(".upload-button").fineUploader({listElement:this.html["upload-dialog"].find(".upload-list"),request:{endpoint:this.siteUrl()+"js/jquery.fineuploader/server/endpoint.php",params:{dir:ibs_mappro.maps_path+"upload/"}},
debug:!1});this.html["ibs-header"].find(".ibs-reset").button({text:!0,label:"Reset",icons:{primary:"ui-icon-stop"}});this.html["ibs-header"].find(".ibs-find").button({text:!0,label:"Find address",icons:{primary:"ui-icon-search"}});this.html["ibs-header"].find(".ibs-map").button({text:!0,label:"Map tools",icons:{secondary:" ui-icon-triangle-1-s"}});this.html["ibs-header"].find(".ibs-route").button({text:!0,label:"Route tools",icons:{secondary:" ui-icon-triangle-1-s"}});this.html["ibs-header"].find(".ibs-display").button({text:!0,
label:"Display options",icons:{secondary:" ui-icon-triangle-1-s"}});this.html["ibs-header"].find(".ibs-draw").button({text:!0,label:"Route options",icons:{secondary:" ui-icon-triangle-1-s"}});"admin"!==this.options.user_type&&this.html["ibs-header"].find(".ui-button").css("font-size","10px");"admin"!==this.options.user_type&&this.html["dd-map"].find(".user-hide").hide();this.html["ibs-header"].find(".ibs-route").button("option","disabled",!0);this.html["ibs-container"].css({width:this.options.width,
height:this.options.height});this.uploadCount=0;this.setHandlers();this.sizeHtml();a(".colorpicker-trigger").attr({title:"click to change color"})};File.prototype.openInfo=function(b){var c="",c="undefined"===typeof b.options.sid?b.options.pid:b.options.sid,c="edit"===this.options.map.options.mode?a("<div>").addClass("info-node").append(a("<div>").append(a("<div>").addClass("info-name").append(a("<span>").text(b.options.name))).append(a("<div>").addClass("info-desc").html(b.options.desc))).append(a("<div>").addClass("info-footer").append(a("<a>").text("edit").attr({rel:c,
action:"edit"})).append(a("<a>").text("remove").attr({rel:c,action:"remove"})).append(a("<a>").text("close").attr({rel:c,action:"close"}))):"undefined"===typeof b.options.sid?a("<div>").addClass("info-node").append(a("<div>").append(a("<div>").addClass("info-name").append(a("<span>").text(b.options.name))).append(a("<div>").addClass("info-desc").html(b.options.desc))).append(a("<div>").addClass("info-footer").append(a("<a>").text("more").attr({rel:c,action:"show"})).append(a("<a>").text("close").attr({rel:c,
action:"close"}))):a("<div>").addClass("info-node").append(a("<div>").append(a("<div>").addClass("info-name").append(a("<span>").text(b.options.name))).append(a("<div>").addClass("info-desc").html(" miles="+this.options.map.convertMeters2(b.distance()).toString()))).append(a("<div>").addClass("info-footer").append(a("<a>").text("more").attr({rel:c,action:"show"})).append(a("<a>").text("profile").attr({rel:c,action:"elevation"})).append(a("<a>").text("close").attr({rel:c,action:"close"})));this.options.map.infowindow.setContent(c[0]);
this.options.map.infowindow.open(this.options.map.googlemap,b.marker)};Segment.prototype.setSegmentItem=function(){var b=this.options.sid;this.segmentList.append(a("<li>").addClass("segment-item").attr({rel:b}).append(a("<div>").addClass("ct-list-div hide").append(a("<a>").attr({href:"#",title:"focus segment"}).append(a("<img>").addClass("segment-focus").attr({rel:b,src:this.options.map.siteUrl()+"image/zoom.png"}))).append(a("<a>").attr({href:"#",title:"elevation profile"}).append(a("<img>").addClass("segment-elevation").attr({rel:b,
src:this.options.map.siteUrl()+"image/chart.png"}))).append(a("<span>").append(a("<a>").attr({href:"#",title:"generate cue sheet"}).append(a("<img>").addClass("segment-cuesheet").attr({rel:b,src:this.options.map.siteUrl()+"image/cue.png"}).data({segment:this}))))).append(a("<a>").addClass("segment-item-name").attr({rel:b,href:"#",title:""}).text(this.options.name)))};Placemark.prototype.setPlacemarkItem=function(){var b=this.options.pid,b=a("<li>").addClass("placemark-item "+b).append(a("<div>").addClass("ct-list-div").append(a("<img>").addClass("placemark-item-image").css({height:"20px"}).attr({rel:b,
alt:"image",src:this.marker.icon.url}))).append(a("<a>").addClass(this.options.map.options.mid+" placemark-item-name name").attr({rel:b,href:"#",title:""}).text(this.options.name));a(this.placemarkList).append(a(b))}})(jQuery);
