(function(f){Map.prototype.elevation=function(a){this.selectedPoint=null;this.elevationSegment=a;try{a.focus()}catch(d){this.elevationSegment=null;return}this.sizeHtml();this.elevationService=new google.maps.ElevationService;this.elevationChart=new google.visualization.AreaChart(this.html["data-chart"][0]);this.elevations=[];google.visualization.events.addListener(this.elevationChart,"onmouseout",f.proxy(function(a){this.elevationSegment&&(this.html["distance-info"].addClass("hide"),this.elevationSegment.distanceMarker.setVisible(!1))},
this));google.visualization.events.addListener(this.elevationChart,"onmouseover",f.proxy(function(a){for(var b=this.elevationSegment.nearestPoint(this.elevations[a.row].location),g=0,e=this.selectedPoint?this.selectedPoint:0,d=a.row,h=e<d?e:d,e=h===e?d:e;h<e;h++)g+=parseFloat(this.elevations[h].gain);h=b.distance;this.selectedPoint&&(b=this.elevationSegment.nearestPoint(this.elevations[this.selectedPoint].location),h=h<b.distance?b.distance-h:h-b.distance);b=this.convertMeters2(h);b+=this.measure2();
this.html["distance-info"].html(b+" total gain "+g.toFixed(2)+this.measure1());this.setMenuXY(this.html["distance-info"],this.elevations[a.row].location);g=parseInt(f(this.html["distance-info"]).css("top").replace(/px/,""));g-=35;f(this.html["distance-info"]).css("top",g+"px");this.html["distance-info"].removeClass("hide");this.elevationSegment.distanceMarker.setPosition(this.elevations[a.row].location);this.elevationSegment.distanceMarker.setVisible(!0)},this));google.visualization.events.addListener(this.elevationChart,
"select",f.proxy(function(a){a=this.elevationChart.getSelection();0<a.length&&a[0].row&&(this.selectedPoint=a[0].row)},this));this.getElevations(a)};Map.prototype.getElevations=function(a){var d=0,c=[];a=a.line.getPath();for(var b=0;b<a.length;b++)b&&(d+=distanceFrom(a.getAt(b-1),a.getAt(b))),c.push({latlng:a.getAt(b),distance:d});a=d/1609/5;b=Math.floor(Math.log(a)/2.302585092994046);b=Math.pow(10,b);a=Math.floor(a/b);a=(5<a?10:2<a?5:2)*b;a=1609*a*Math.ceil(d/1609/a)/750;b=[];b.push(c[0].latlng);
for(var g=1,e=0;750>g&&g*a<=d;){for(;g*a>c[e+1].distance;)e++;var f=(g*a-c[e].distance)/(c[e+1].distance-c[e].distance);try{b.push(google.maps.geometry.spherical.interpolate(c[e].latlng,c[e+1].latlng,f))}catch(h){alert("geometry(?) threw error: "+h+"\n\nArgument to interpolate: "+c[e].latlng+","+c[e+1].latlng+","+f+"\npIndex: "+e);for(var f="",k=e-10;e+10>k;k++)f=f+k+"-"+c[k].latlng+"| ";alert(f)}g++}b.push(c[c.length-1].latlng);this.getElevationParts(b,0)};Map.prototype.getElevationParts=function(a,
d){var c=250<a.length?a.slice(0,250):a;a=250<a.length?a.slice(250):[];this.elevationService.getElevationForLocations({locations:c},f.proxy(function(b,c){c!==google.maps.ElevationStatus.OK?alert("received status "+c):(this.elevations=this.elevations.concat(b),d+=b.length,0<a.length?this.getElevationParts(a,d):this.showElevationChart())},this))};Map.prototype.showElevationChart=function(){var a=new google.visualization.DataTable;a.addColumn("string","Sample");a.addColumn("number","Elevation");var d=
0;for(i=0;i<this.elevations.length;i++){if(0<i&&this.elevations[i].elevation>this.elevations[i-1].elevation){var c=parseFloat(this.convertMeters1(this.elevations[i].elevation)),b=parseFloat(this.convertMeters1(this.elevations[i-1].elevation));this.elevations[i].gain=c-b;d+=c-b}else this.elevations[i].gain=0;a.addRow(["",parseFloat(this.convertMeters1(this.elevations[i].elevation))])}c="Elevation "+this.measure1();this.elevationChart.draw(a,{legend:"none",titleY:c,focusBorderColor:"#00ff00",backgroundColor:"white",
colors:["Blue"],tooltipTextStyle:{visibility:"hidden"}});this.elevationChart.setSelection([{row:0,col:1}]);this.html.data.find(".data-segment").html("<strong>Segment:</strong> "+this.elevationSegment.options.name);this.html.data.find(".data-distance").html("<strong>Distance:</strong> "+this.convertMeters2(this.elevationSegment.distance())+this.measure2());this.html.data.find(".data-gain").html("<strong>Climbing:</strong> "+d.toFixed(2)+this.measure1());this.sizeHtml()}})(jQuery);
